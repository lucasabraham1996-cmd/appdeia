<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>🌟 Desafío de IA y Ciencia de Datos 🚀</title>
    <!-- 1. Cargar Tailwind CSS --><script src="https://cdn.tailwindcss.com"></script>
    
    <!-- 2. Cargar la fuente Inter --><link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap" rel="stylesheet">
    
    <style>
        /* 3. Aplicar la fuente base y estilos de fondo */
        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(135deg, #a78bfa 0%, #6366f1 100%); /* Degradado morado/azul */
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 1rem;
        }
        /* Estilo para el contenedor principal */
        #game-container {
            background-color: white;
            border-radius: 1.5rem; /* Bordes más redondeados */
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.2), 0 10px 10px -5px rgba(0, 0, 0, 0.1); /* Sombra más pronunciada */
            padding: 2.5rem;
            transition: all 0.3s ease-in-out;
            max-width: 48rem; /* Ancho máximo aumentado */
        }
        /* Animación de entrada */
        .fade-in {
            animation: fadeIn 0.6s ease-out;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        /* Estilos de botones de elección */
        .choice-button {
            transition: all 0.2s ease-in-out;
        }
        .choice-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
        }
        .choice-button.selected {
            border-color: #4f46e5; /* Color morado */
            background-color: #eef2ff; /* Fondo más claro para seleccionado */
            color: #4f46e5;
            box-shadow: 0 0 0 3px rgba(79, 70, 229, 0.3);
        }
        .ai-image-placeholder {
            min-height: 200px;
            display: flex;
            align-items: center;
            justify-content: center;
            background-color: #f0f9ff; /* Azul claro */
            border: 2px dashed #93c5fd; /* Borde punteado azul */
            color: #3b82f6; /* Texto azul */
            font-style: italic;
            text-align: center;
            padding: 1rem;
        }
    </style>
</head>
<body>

    <div class="w-full max-w-3xl">
        <div id="game-container" class="transition-all duration-300">
            
            <!-- Encabezado -->
            <header class="text-center mb-8 relative">
                <!-- BOTÓN FULLSCREEN AÑADIDO -->
                <button id="fullscreen-button" title="Jugar en Pantalla Completa" class="absolute top-0 right-0 p-2 text-slate-400 hover:text-indigo-600 transition-colors">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 8V4m0 0h4M4 4l5 5m11-1v4m0 0h-4m4-4l-5 5M4 16v4m0 0h4m-4 0l5-5m11 5v-4m0 0h-4m4 4l-5-5"></path></svg>
                </button>
                <!-- FIN BOTÓN FULLSCREEN -->

                <h1 class="text-4xl sm:text-5xl font-extrabold text-indigo-700 leading-tight">
                    🌟 Desafío <span class="text-purple-600">IA & Datos</span> 🚀
                </h1>
                <p class="text-xl text-slate-600 mt-2">
                    Pon a prueba tu intuición y conocimiento
                </p>
            </header>

            <!-- Área de contenido del juego (dinámica) --><main id="game-content" class="mb-8 min-h-[250px] sm:min-h-[200px] flex flex-col justify-center">
                <!-- El contenido del juego se inyectará aquí --></main>

            <!-- Área de retroalimentación (dinámica) --><div id="feedback-area" class="mb-8">
                <!-- La retroalimentación (correcto/incorrecto) irá aquí --></div>

            <!-- Controles --><footer id="controls" class="flex flex-col sm:flex-row justify-between items-center gap-4">
                <button id="restart-button" class="w-full sm:w-auto bg-slate-200 text-slate-700 font-semibold py-3 px-6 rounded-xl hover:bg-slate-300 transition-all text-lg">
                    🔄 Reiniciar Juego
                </button>
                <!-- El botón de "Comprobar" o "Siguiente" se añadirá aquí dinámicamente --><div id="action-button-container" class="w-full sm:w-auto"></div>
            </footer>
            
        </div>
    </div>

    <script>
        // --- FUNCIÓN PARA BARAJAR ---
        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
        }

        // --- BASE DE DATOS DEL JUEGO ---
        const gameData = [
            // --- Nivel 1: Predice el Futuro ---
            {
                type: 'predict',
                title: '📊 Predice el Futuro (1/3)',
                question: 'Una cafetería vendió ☕ <strong>120, 145, 170 y 195</strong> cafés en los últimos cuatro días. Siguiendo esta tendencia, ¿cuántos venderá mañana?',
                answer: '220',
                explanation: '¡Exacto! La tendencia es sumar 25 cafés cada día. Esto es un ejemplo de <strong>regresión lineal</strong>, un modelo que busca patrones de crecimiento constante.'
            },
            // --- PREGUNTAS FALTANTES EN EL ARCHIVO ROTO ---
            // (Añadidas de nuevo para completar el juego)
            {
                type: 'predict',
                title: '📊 Predice el Futuro (2/3)',
                question: 'Una app de meditación tuvo 🧘‍♀️ <strong>500, 1000, 2000 y 4000</strong> descargas en sus primeras cuatro semanas. Si sigue duplicándose, ¿cuántas obtendrá la quinta semana?',
                answer: '8000',
                explanation: '¡Correcto! La tendencia se está duplicando (x2) cada semana. Esto es <strong>crecimiento exponencial</strong>. Los modelos predictivos pueden identificar patrones mucho más complejos.'
            },
            {
                type: 'predict',
                title: '📊 Predice el Futuro (3/3)',
                question: 'Un blog de noticias tecnológicas tuvo 📈 <strong>1000, 950, 900 y 850</strong> visitas en los últimos cuatro días. Si su ritmo de visitas sigue disminuyendo igual, ¿cuántas tendrá mañana?',
                answer: '800',
                explanation: '¡Muy bien! La tendencia es restar 50 visitas cada día. Los modelos no solo predicen aumentos, sino también disminuciones. ¡La Ciencia de Datos nos ayuda a entender el pasado para mirar al futuro!'
            },
            // --- Nivel 2: IA o Humano (PREGUNTAS ACTUALIZADAS) ---
            {
                type: 'ai-human',
                title: '🎮 IA o Humano (1/3)',
                content: {
                    type: 'image',
                    // Simulación de la petición del usuario
                    prompt: 'imagen1.png (Simulando una foto subida). Es un retrato de una abuela sonriendo, pero la textura de la piel se ve demasiado perfecta y los ojos tienen un brillo extraño.'
                },
                question: 'Esta foto, "imagen1.png", que parece ser un retrato familiar, ¿fue generada por IA o es una foto humana real?',
                answer: 'ia',
                explanation: '¡Acertaste! Es de IA. Las IAs son geniales creando retratos, pero a veces fallan en detalles sutiles como la textura "demasiado perfecta" de la piel o reflejos extraños en los ojos. Es un error común de las IAs actuales.'
            },
            {
                type: 'ai-human',
                title: '🎮 IA o Humano (2/3)',
                content: {
                    type: 'text',
                    text: 'Fui a la tienda pero se me olvidó la lista, obvio. Traje pan, leche... y creo que lo más importante no. Jajaja. Mañana será otro día.'
                },
                question: 'Este mensaje de texto, con sus errores y su estilo casual... ¿es de una IA o de un humano?',
                answer: 'humano',
                explanation: '¡Correcto! Es 100% humano. El "obvio", el "jajaja" y la estructura de pensamiento (olvidar la lista) son patrones muy típicos de la comunicación humana informal, algo que a las IAs les cuesta replicar con naturalidad.'
            },
            {
                type: 'ai-human',
                title: '🎮 IA o Humano (3/3)',
                content: {
                    type: 'text',
                    text: 'El análisis de sentimiento del mercado indica una volatilidad alcista, correlacionada con los patrones de inversión en derivados de tecnología emergente. Se recomienda una estrategia de diversificación de portafolio para mitigar el riesgo.'
                },
                question: 'Este análisis financiero, tan formal y técnico... ¿fue escrito por una IA o por un analista humano experto?',
                answer: 'ia',
                explanation: '¡Es de una IA! Este es un truco. Aunque un humano PODRÍA escribir esto, las IAs son *extremadamente* buenas generando texto técnico, formal y lleno de jerga. A menudo lo hacen de forma más densa y rápida que un humano.'
            },
            // --- Nivel 3: Arma tu Red Neuronal ---
            {
                type: 'network',
                title: '🧩 Arma tu Red Neuronal (1/3)',
                question: 'Es la 🥇 PRIMERA capa de la red. Recibe los datos crudos (ej: los píxeles de una foto 🖼️, o las palabras de una frase 💬). ¿Cómo se llama?',
                options: ['Capa de Salida', 'Capa Oculta', 'Capa de Entrada'],
                answer: 'Capa de Entrada',
                explanation: '¡Exacto! La <strong>Capa de Entrada (Input Layer)</strong> es como los "sentidos" (ojos, oídos) de la red. Es la puerta por donde entra toda la información del mundo exterior. ¡Fundamental!'
            },
            {
                type: 'network',
                title: '🧩 Arma tu Red Neuronal (2/3)',
                question: 'Es el 🧠 "cerebro" de la red. Aquí es donde ocurren los cálculos complejos y donde la red "aprende" a encontrar patrones. Puede haber muchas de estas capas, actuando como "filtros".',
                options: ['Capa Oculta', 'Capa de Salida', 'Capa de Entrada'],
                answer: 'Capa Oculta',
                explanation: '¡Correcto! Las <strong>Capas Ocultas (Hidden Layers)</strong> hacen el trabajo pesado. Procesan la información, la transforman y extraen características, como si fueran pequeños especialistas trabajando en equipo.'
            },
            {
                type: 'network',
                title: '🧩 Arma tu Red Neuronal (3/3)',
                question: 'Es la 🏆 ÚLTIMA capa de la red. Da la respuesta final y concreta (Ej: "Es un gato 🐱", "Es spam 🗑️", "El precio será $150 💰"). ¡El resultado que esperábamos!',
                options: ['Capa de Entrada', 'Capa Oculta', 'Capa de Salida'],
                answer: 'Capa de Salida',
                explanation: '¡Perfecto! La <strong>Capa de Salida (Output Layer)</strong> es la "boca" de la red. Entrega la conclusión final después de todo el procesamiento. ¡Has armado tu red neuronal completa y entiendes su flujo de información!'
            }
        ];

        // --- LÓGICA DEL JUEGO ---
        let currentGameIndex = 0;
        let score = 0; // <-- AÑADIDO: Contador de puntos
        let selectedChoice = null; // Para guardar la opción seleccionada en juegos de elección

        // Elementos del DOM
        const gameContent = document.getElementById('game-content');
        const feedbackArea = document.getElementById('feedback-area');
        const actionButtonContainer = document.getElementById('action-button-container');
        const restartButton = document.getElementById('restart-button');
        const gameTitle = document.querySelector('#game-container h1');
        const gameSubtitle = document.querySelector('#game-container p');

        // Función para renderizar el juego actual
        function renderGame(index) {
            // Limpiar áreas
            gameContent.innerHTML = '';
            feedbackArea.innerHTML = '';
            actionButtonContainer.innerHTML = '';
            selectedChoice = null; // Resetear selección

            // Efecto de fade-in
            gameContent.classList.remove('fade-in');
            void gameContent.offsetWidth; // Truco para reiniciar la animación
            gameContent.classList.add('fade-in');

            // --- Pantalla de victoria ---
            if (index >= gameData.length) {
                gameTitle.innerHTML = '🎉 ¡Juego Terminado! 🎉';
                gameSubtitle.textContent = 'Este es tu puntaje final';

                // --- NUEVA PANTALLA FINAL CON PUNTAJE ---
                // FIX: Asegurarse de que gameData.length no sea 0 para evitar dividir por cero
                let finalPercentage = 0;
                if (gameData.length > 0) {
                    finalPercentage = Math.round((score / gameData.length) * 100);
                }
                
                let congratsMessage = "¡Buen intento! Sigue practicando. 🧠";
                if (finalPercentage >= 90) {
                    congratsMessage = "¡Excelente! Eres un experto en IA. 🚀";
                } else if (finalPercentage >= 60) {
                    congratsMessage = "¡Muy bien! Tienes una gran intuición para los datos. 👍";
                }

                gameContent.innerHTML = `
                    <div class="text-center">
                        <div class="text-7xl font-extrabold text-indigo-700 mb-4">${score} / ${gameData.length}</div>
                        <div class="text-3xl font-bold text-purple-600 mb-3">${finalPercentage}% de aciertos</div>
                        <p class="text-xl text-slate-700 mt-6 font-semibold">
                            ${congratsMessage}
                        </p>
                        <p class="text-slate-600 mt-3 text-lg">
                            ¡Presiona "Reiniciar" para mezclar las preguntas y jugar de nuevo!
                        </p>
                    </div>
                `;
                // --- FIN DE PANTALLA FINAL ---
                return;
            }

            const game = gameData[index];

            // Restaurar título original
            gameTitle.innerHTML = '🌟 Desafío <span class="text-purple-600">IA & Datos</span> 🚀';
            gameSubtitle.textContent = 'Pon a prueba tu intuición y conocimiento';

            let contentHtml = `<h2 class="text-2xl font-bold text-indigo-700 mb-6 text-center">${game.title}</h2>`;

            // Renderizar según el tipo de juego
            switch (game.type) {
                case 'predict':
                    contentHtml += `
                        <p class="text-lg text-slate-700 mb-6 text-center">${game.question}</p>
                        <input type="text" id="predict-input" class="w-full sm:w-2/3 mx-auto block text-lg p-3 border-2 border-slate-300 rounded-lg focus:border-purple-500 focus:ring-2 focus:ring-purple-200 transition-all shadow-sm" placeholder="✍️ Escribe tu respuesta...">
                    `;
                    
                    // FIX: Inyectar el HTML en el DOM ANTES de configurar los listeners
                    gameContent.innerHTML = contentHtml; 
                    
                    createActionButton('Comprobar ✅', () => checkPredictAnswer(game.answer, game.explanation));
                    // Permitir enviar con "Enter"
                    setTimeout(() => {
                        const inputElement = document.getElementById('predict-input');
                        if (inputElement) {
                            inputElement.focus();
                            inputElement.addEventListener('keypress', function(e) {
                                if (e.key === 'Enter') {
                                    // FIX: Asegurarse de que el botón de comprobar exista antes de hacer clic
                                    const checkButton = actionButtonContainer.querySelector('button');
                                    if(checkButton) checkButton.click();
                                }
                            });
                        }
                    }, 100);
                    break;

                case 'ai-human':
                    let mediaHtml = '';
                    if (game.content.type === 'image') {
                        // --- HTML DE IMAGEN ACTUALIZADO ---
                        // Usamos un placeholder real y mostramos el prompt como descripción
                        let imageUrl = 'https://placehold.co/600x400/a78bfa/ffffff?text=Arte+IA&font=inter';
                        let altText = "Imagen de arte generada por IA";
                        
                        if (game.content.prompt.includes("imagen1.png")) {
                            imageUrl = 'https://placehold.co/600x400/eeeeee/999999?text=imagen1.png&font=inter';
                            altText = "Placeholder para imagen1.png";
                        }

                        mediaHtml = `
                            <div class="mb-6 text-center">
                                <img src="${imageUrl}" alt="${altText}" class="w-full max-w-md mx-auto rounded-lg shadow-md mb-3 border-4 border-white">
                                <p class="text-sm text-slate-600 italic px-4">
                                    <span class="font-bold">Descripción:</span> "${game.content.prompt}"
                                </p>
                            </div>
                        `;
                        // --- FIN DE ACTUALIZACIÓN ---
                    } else {
                        mediaHtml = `<div class="bg-blue-50 p-5 rounded-xl border border-blue-200 text-blue-800 italic text-center text-lg mb-6 shadow-sm">"${game.content.text}"</div>`;
                    }
                    contentHtml += `
                        ${mediaHtml}
                        <p class="text-xl text-slate-700 mb-6 text-center font-semibold">${game.question}</p>
                        <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                            <button id="ai-button" class="choice-button bg-gradient-to-r from-purple-500 to-indigo-500 text-white p-4 rounded-xl font-bold text-lg hover:from-purple-600 hover:to-indigo-600 transition-all shadow-lg" data-answer="ia">🤖 Hecho por IA</button>
                            <button id="human-button" class="choice-button bg-gradient-to-r from-green-500 to-teal-500 text-white p-4 rounded-xl font-bold text-lg hover:from-green-600 hover:to-teal-600 transition-all shadow-lg" data-answer="humano">👤 Hecho por Humano</button>
                        </div>
                    `;
                    gameContent.innerHTML = contentHtml; // Renderizar antes de adjuntar eventos
                    // Adjuntar eventos después de que el HTML esté en el DOM
                    document.getElementById('ai-button').addEventListener('click', () => handleChoice(game, 'ia'));
                    document.getElementById('human-button').addEventListener('click', () => handleChoice(game, 'humano'));
                    break;

                case 'network':
                    contentHtml += `
                        <p class="text-xl text-slate-700 mb-6 text-center font-semibold">${game.question}</p>
                        <div class="flex flex-col gap-4">
                            ${game.options.map((option, idx) => `
                                <button id="option-${idx}" class="choice-button w-full text-left bg-indigo-50 text-indigo-800 p-4 rounded-xl font-semibold text-lg hover:bg-indigo-100 border-2 border-transparent hover:border-purple-400 transition-all shadow-sm" data-answer="${option}">
                                    ${option}
                                </button>
                            `).join('')}
                        </div>
                    `;
                    gameContent.innerHTML = contentHtml; // Renderizar antes de adjuntar eventos
                    game.options.forEach((option, idx) => {
                        document.getElementById(`option-${idx}`).addEventListener('click', () => handleChoice(game, option));
                    });
                    break;
            }
        }

        // --- Funciones de Ayuda ---

        // Manejar la selección de botones en juegos de elección
        function handleChoice(game, choice) {
            selectedChoice = choice;
            // Desactivar todos los botones de elección y marcar el seleccionado
            document.querySelectorAll('.choice-button').forEach(button => {
                button.disabled = true; // Deshabilitar para evitar múltiples clics
                button.classList.remove('selected');
                if (button.dataset.answer === choice) {
                    button.classList.add('selected');
                }
            });
            checkAnswer(selectedChoice === game.answer.toLowerCase(), game.explanation);
        }


        // Crear botón de acción principal (Comprobar / Siguiente)
        function createActionButton(text, onClick, isDisabled = false) {
            actionButtonContainer.innerHTML = '';
            const button = document.createElement('button');
            button.textContent = text;
            button.className = 'w-full sm:w-auto bg-blue-600 text-white font-bold py-3 px-6 rounded-xl hover:bg-blue-700 transition-all text-lg shadow-lg disabled:opacity-50 disabled:cursor-not-allowed';
            button.onclick = onClick;
            button.disabled = isDisabled;
            actionButtonContainer.appendChild(button);
        }

        // --- FUNCIÓN showFeedback (RESTAURADA) ---
        function showFeedback(isCorrect, explanation) {
            feedbackArea.innerHTML = '';
            const feedbackDiv = document.createElement('div');
            feedbackDiv.className = `p-5 rounded-xl fade-in text-lg shadow-md ${isCorrect ? 'bg-green-50 border border-green-300' : 'bg-red-50 border border-red-300'}`;
            
            if (isCorrect) {
                score++; // <-- AÑADIDO: Incrementar puntos
                feedbackDiv.innerHTML = `
                    <h3 class="font-bold text-xl text-green-800 flex items-center mb-2">
                        <span class="mr-2">🎉</span> ¡Correcto! (+1 punto)
                    </h3>
                    <p class="text-green-700">${explanation}</p>
                `;
            } else {
                feedbackDiv.innerHTML = `
                    <h3 class="font-bold text-xl text-red-800 flex items-center mb-2">
                        <span class="mr-2">❌</span> ¡Incorrecto!
                    </h3>
                    <p class="text-red-700">${explanation}</p>
                `;
            }
            
            // --- MODIFICADO: Siempre crear botón "Siguiente" ---
            feedbackArea.appendChild(feedbackDiv);
            createActionButton('Siguiente →', () => {
                currentGameIndex++;
                renderGame(currentGameIndex);
            });
        }

        // --- FUNCIONES FALTANTES (RESTAURADAS) ---
        // Comprobar respuesta de predicción
        function checkPredictAnswer(correctAnswer, explanation) {
            const input = document.getElementById('predict-input');
            if (!input) return; // Guarda de seguridad
            const userAnswer = input.value.trim();
            showFeedback(userAnswer === correctAnswer, explanation);
        }

        // Comprobar respuesta de elección (IA/Humano, Red Neuronal)
        function checkAnswer(isCorrect, explanation) {
            showFeedback(isCorrect, explanation);
        }
        
        // --- FUNCIÓN FULLSCREEN (EN SU LUGAR CORRECTO) ---
        function toggleFullScreen() {
            const doc = document.documentElement;
            if (!document.fullscreenElement) {
                // Pedir pantalla completa
                if (doc.requestFullscreen) {
                    doc.requestFullscreen();
                } else if (doc.mozRequestFullScreen) { // Firefox
                    doc.mozRequestFullScreen();
                } else if (doc.webkitRequestFullscreen) { // Chrome, Safari y Opera
                    doc.webkitRequestFullscreen();
                } else if (doc.msRequestFullscreen) { // IE/Edge
                    doc.msRequestFullscreen();
                }
            } else {
                // Salir de pantalla completa
                if (document.exitFullscreen) {
                    document.exitFullscreen();
                } else if (document.mozCancelFullScreen) { // Firefox
                    document.mozCancelFullScreen();
                } else if (document.webkitExitFullscreen) { // Chrome, Safari y Opera
                    document.webkitExitFullscreen();
                } else if (document.msExitFullscreen) { // IE/Edge
                    document.msExitFullscreen();
                }
            }
        }

        // --- Inicialización ---
        restartButton.addEventListener('click', () => {
            currentGameIndex = 0;
            score = 0; // <-- AÑADIDO: Reiniciar puntos
            shuffleArray(gameData); // <-- AÑADIDO: Volver a barajar
            renderGame(currentGameIndex);
        });

        // Cargar el primer juego al iniciar
        document.addEventListener('DOMContentLoaded', () => {
            // AÑADIDO: Listener para el botón de pantalla completa
            document.getElementById('fullscreen-button').addEventListener('click', toggleFullScreen);
            
            shuffleArray(gameData); // <-- AÑADIDO: Barajar al inicio
            renderGame(currentGameIndex);
        });
    </script>
</body>
</html>

